<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sky.mapper.ContryMacroEconomyIndexMapper">
    <resultMap id="BaseResultMap" type="com.sky.model.ContryMacroEconomyIndex">
        <id column="id" property="id"/>
        <result column="version" property="version"/>
        <result column="isvalid" property="isvalid"/>
        <result column="create_time" property="createTime"/>
        <result column="create_user" property="createUser"/>
        <result column="update_time" property="updateTime"/>
        <result column="update_user" property="updateUser"/>

        <result column="class_code" property="classCode"/>
        <result column="contry_class" property="contryClass"/>
        <result column="publish_day" property="publishDay"/>
        <result column="index_class" property="indexClass"/>
        <result column="sub_index_class" property="subIndexClass"/>
        <result column="publish_value" property="publishValue"/>
    </resultMap>

    <select id="getContryMacroEconomy" parameterType="java.lang.String" resultType="com.sky.vo.MacroEconomy_VO">
        SELECT
        a.*
        FROM(
        SELECT
        CASE WHEN LENGTH(publish_day) = 13 THEN FROM_UNIXTIME(LEFT(publish_day,10),'%Y-%m-%d')
             ELSE FROM_UNIXTIME(LEFT(publish_day,9),'%Y-%m-%d')
             END AS publishDay ,
        sub_index_class className ,
        publish_value publishValue
        FROM contry_macro_economy_index
        <where>
            <if test="indexCode != null and indexCode != '' and indexCode != 'undefined'">
                class_code = #{indexCode}
            </if>
            <if test="contry != null and contry != '' and contry != 'undefined'">
                AND contry_class = #{contry}
            </if>
        </where>
        ) a
        <where>
            <if test="startDay != null and startDay != '' and startDay != 'undefined'">
                a.publishDay >= #{startDay}
            </if>
            <if test="endDay != null and endDay != '' and endDay != 'undefined'">
                AND a.publishDay &lt; #{endDay}
            </if>
        </where>
        ORDER BY a.publishDay
    </select>
</mapper>